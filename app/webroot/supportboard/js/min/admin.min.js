"use strict";!function(t){function e(){SBF.updateUsersActivity(SB_CURRENT_AGENT.id,0!=s()?s().id:-1,function(e){"online"==e?SBChat.user_online||(t(d).find(".sb-conversation .sb-top > .sb-labels").prepend(`<span class="sb-status-online">${o("Online")}</span>`),SBChat.user_online=!0):(t(d).find(".sb-conversation .sb-top .sb-status-online").remove(),SBChat.user_online=!1)})}function i(e,i,s){var a=t(l).find(".sb-info-card"),n="";SBF.null(s)||"error"!=s?t(a).removeClass("sb-info-card-error"):t(a).addClass("sb-info-card-error"),SBF.null(i)||(n=`<p>${i}</p>`),t(a).html(`<h3>${e}</h3>${n}`).sbActivate(),clearTimeout(m),m=setTimeout(function(){t(a).sbActivate(!1)},5e3)}function s(t){if(void 0===t)return window.sb_current_user;window.sb_current_user=t}function a(e,i,s){let a=t(l).find(".sb-dialog-box").attr("data-type",i);t(a).find("p").html(("alert"==i?o("Are you sure to continue?")+" ":"")+o(e)),t(a).sbActivate().css({"margin-top":t(a).outerHeight()/-2+"px","margin-left":t(a).outerWidth()/-2+"px"}),t(l).find(".sb-lightbox-overlay").sbActivate(),_=s}function n(e=!0,i=!0){t(l).find(".sb-loading-global"+(i?",.sb-lightbox-overlay":"")).sbActivate(e)}function o(t){return 0!=SB_TRANSLATIONS&&t in SB_TRANSLATIONS?SB_TRANSLATIONS[t]:t}function r(){"undefined"!=typeof caches&&caches.delete("sb-pwa-cache")}var l,c,d,u,f,p,h,b,g,v,m,_,k=[],x={},y=[],S=0,w=t(window).width()<426,B={last:0,header:!0,always_hidden:!1},A="localhost"===location.hostname||"127.0.0.1"===location.hostname;t.fn.miniTip=function(e){var i=t.extend({title:"",content:!1,delay:300,anchor:"n",event:"hover",fadeIn:200,fadeOut:200,aHide:!0,maxW:"250px",offset:5,stemOff:0,doHide:!1},e);0==t(l).find("#miniTip").length&&t(l).append('<div id="miniTip" class="sb-tooltip"><div></div></div>');var s=t(l).find("#miniTip"),a=s.find("div");return i.doHide?(s.stop(!0,!0).fadeOut(i.fadeOut),!1):this.each(function(){var e=t(this),n=i.content?i.content:e.attr("title");if(""!=n&&void 0!==n){window.delay=!1;var o=!1,r=!0;i.content||e.removeAttr("title"),"hover"==i.event?(e.hover(function(){s.removeAttr("click"),r=!0,l.call(this)},function(){r=!1,c()}),i.aHide||s.hover(function(){o=!0},function(){o=!1,setTimeout(function(){!r&&!s.attr("click")&&c()},20)})):"click"==i.event&&(i.aHide=!0,e.click(function(){return s.attr("click","t"),s.data("last_target")!==e?l.call(this):"none"==s.css("display")?l.call(this):c(),s.data("last_target",e),t("html").unbind("click").click(function(e){"block"==s.css("display")&&!t(e.target).closest("#miniTip").length&&(t("html").unbind("click"),c())}),!1}));var l=function(){i.show&&i.show.call(this,i),i.content&&""!=i.content&&(n=i.content),a.html(n),i.render&&i.render(s),s.hide().width("").width(s.width()).css("max-width",i.maxW);var o=e.is("area");if(o){var r,l=[],c=[],d=e.attr("coords").split(",");function u(t,e){return t-e}for(r=0;r<d.length;r++)l.push(d[r++]),c.push(d[r]);var f=e.parent().attr("name"),p=t("img[usemap=\\#"+f+"]").offset(),h=parseInt(p.left,10)+parseInt((parseInt(l.sort(u)[0],10)+parseInt(l.sort(u)[l.length-1],10))/2,10),b=parseInt(p.top,10)+parseInt((parseInt(c.sort(u)[0],10)+parseInt(c.sort(u)[c.length-1],10))/2,10)}else b=parseInt(e.offset().top,10),h=parseInt(e.offset().left,10);var g=o?0:parseInt(e.outerWidth(),10),v=o?0:parseInt(e.outerHeight(),10),m=s.outerWidth(),_=s.outerHeight(),k=Math.round(h+Math.round((g-m)/2)),x=Math.round(b+v+i.offset+8),y=Math.round(m-16)/2-parseInt(s.css("borderLeftWidth"),10),S=0,w=h+g+m+i.offset+8>parseInt(t(window).width(),10),B=m+i.offset+8>h,A=_+i.offset+8>b-t(window).scrollTop(),C=b+v+_+i.offset+8>parseInt(t(window).height()+t(window).scrollTop(),10),$=i.anchor;B||"e"==i.anchor&&!w?"w"!=i.anchor&&"e"!=i.anchor||($="e",S=Math.round(_/2-8-parseInt(s.css("borderRightWidth"),10)),y=-8-parseInt(s.css("borderRightWidth"),10),k=h+g+i.offset+8,x=Math.round(b+v/2-_/2)):(w||"w"==i.anchor&&!B)&&("w"!=i.anchor&&"e"!=i.anchor||($="w",S=Math.round(_/2-8-parseInt(s.css("borderLeftWidth"),10)),y=m-parseInt(s.css("borderLeftWidth"),10),k=h-m-i.offset-8,x=Math.round(b+v/2-_/2))),C||"n"==i.anchor&&!A?"n"!=i.anchor&&"s"!=i.anchor||($="n",S=_-parseInt(s.css("borderTopWidth"),10),x=b-(_+i.offset+8)):(A||"s"==i.anchor&&!C)&&("n"!=i.anchor&&"s"!=i.anchor||($="s",S=-8-parseInt(s.css("borderBottomWidth"),10),x=b+v+i.offset+8)),"n"==i.anchor||"s"==i.anchor?m/2>h?(k=k<0?y+k:y,y=0):h+m/2>parseInt(t(window).width(),10)&&(k-=y,y*=2):A?(x+=S,S=0):C&&(x-=S,S*=2),delay&&clearTimeout(delay),delay=setTimeout(function(){s.css({"margin-left":k+"px","margin-top":x+"px"}).stop(!0,!0).fadeIn(i.fadeIn)},i.delay),s.attr("class","sb-tooltip "+$)},c=function(){(!i.aHide&&!o||i.aHide)&&(delay&&clearTimeout(delay),delay=setTimeout(function(){d()},i.delay))},d=function(){!i.aHide&&!o||i.aHide?(s.stop(!0,!0).fadeOut(i.fadeOut),i.hide&&i.hide.call(this)):setTimeout(function(){c()},200)}}})},t.fn.sbShowLightbox=function(){t(l).find(".sb-lightbox").sbActivate(!1),t(".sb-lightbox-overlay").sbActivate(),t(this).sbActivate().css({"margin-top":t(this).outerHeight()/-2+"px","margin-left":t(this).outerWidth()/-2+"px"}),this.preventDefault},t.fn.sbHideLightbox=function(){t(this).find(".sb-lightbox,.sb-lightbox-overlay").sbActivate(!1)},window.sbDialogAdmin=function(t,e,i){a(t,e,i)};var C={init:!1,translations_to_update:[],save:function(e){if(!t(e).sbLoading()){let n={},o={},r=t(g).find(".sb-top-bar .sb-menu-wide .sb-active").attr("id");switch(t(e).sbLoading(!0),r){case"tab-articles":y.length?(this.articles("save"),SBF.ajax({function:"save-articles",articles:y},()=>{i("Articles saved"),t(e).sbLoading(!1)})):t(e).sbLoading(!1);break;case"tab-translations":let l={};for(var s=0;s<this.translations_to_update.length;s++){let e=this.translations_to_update[s],i=t(g).find('.sb-translations .sb-content [data-code="'+e+'"]'),n={front:{},admin:{}};for(var a in n)t(i).find(' > [data-area="'+a+'"] .sb-input-setting:not(.sb-new-translation)').each(function(){n[a][t(this).find("label").html()]=t(this).find("input").val()});t(i).find(".sb-new-translation").each(function(){let e=t(this).find("input:first-child").val(),i=t(this).find("input:last-child").val();""!=e&&""!=i&&(n.front[e]=i)}),l[e]=n}SBF.ajax({function:"save-translations",translations:l},()=>{i("Settings saved"),t(e).sbLoading(!1)});break;default:t(g).find(".sb-setting").each((e,i)=>{let s=this.get(i),a=t(i).data("setting");if(""!=s[0]){let t=[s[1],s[2]];void 0!==a?(a in n||(n[a]={}),n[a][s[0]]=t):o[s[0]]=t}}),SBF.ajax({function:"save-settings",settings:o,external_settings:n},()=>{i("Settings saved"),t(e).sbLoading(!1)})}}},initPlugins:function(){t(g).find("textarea").each(function(){t(this).autoExpandTextarea(),t(this).manualExpandTextarea()})},get:function(e){let i=t(e).attr("id"),s=t(e).data("type");switch(s){case"upload":case"range":case"number":case"text":case"password":case"color":return[i,t(e).find("input").val(),s];case"textarea":return[i,t(e).find("textarea").val(),s];case"select":return[i,t(e).find("select").val(),s];case"checkbox":return[i,t(e).find("input").is(":checked"),s];case"radio":let a=t(e).find("input:checked").val();return SBF.null(a)&&(a=""),[i,a,s];case"upload-image":let n=t(e).find(".image").attr("data-url");return SBF.null(n)&&(n=""),[i,n,s];case"multi-input":let o={};return t(e).find(".input > div").each((t,e)=>{let i=this.get(e);o[i[0]]=[i[1],i[2]]}),[i,o,s];case"select-image":return[i,t(e).find(".thumbs > .active").data("id"),s];case"repeater":return[i,this.repeater("get",t(e).find(".repeater-item"),""),s];case"double-select":let r={};return t(e).find(".input > div").each(function(){let e=t(this).find("select").val();-1!=e&&(r[t(this).attr("data-id")]=[e])}),[i,r,s];case"timetable":let l={},c=new Date,d=Math.abs(c.getTimezoneOffset()),u=Math.floor(d/60),f=d%60;return t(e).find(".sb-timetable > [data-day]").each(function(){let e=t(this).attr("data-day"),i=[];t(this).find("> div > div").each(function(){let e=t(this).html(),s=t(this).attr("data-value");if(SBF.null(s))i.push(["",""]);else if("closed"==s)i.push(["closed","Closed"]);else if(SBF.null(t(this).attr("data-utc"))){let t=parseInt(s.split(":")[0])+u,a=parseInt(s.split(":")[1])+f;i.push([t+":"+a,e])}else i.push([s,e])}),l[e]=i}),[i,l,s]}return["","",""]},set:function(e,i){let s=t(i)[1],a=t(i)[0];switch(e=`#${e}`,s){case"color":case"upload":case"number":case"text":case"password":t(g).find(`${e} input`).val(SBF.restoreJson(a));break;case"textarea":t(g).find(`${e} textarea`).val(SBF.restoreJson(a));break;case"select":t(g).find(`${e} select`).val(SBF.restoreJson(a));break;case"checkbox":t(g).find(`${e} input`).prop("checked","false"!=a&&a);break;case"radio":t(g).find(`${e} input[value="${SBF.restoreJson(a)}"]`).prop("checked",!0);break;case"upload-image":""!=a&&t(g).find(e+" .image").attr("data-url",SBF.restoreJson(a)).css("background-image",`url(${SBF.restoreJson(a)})`);break;case"multi-input":for(var n in a)this.set(n,a[n]);break;case"range":let i=SBF.restoreJson(a);t(g).find(e+" input").val(i),t(g).find(e+" .range-value").html(i);break;case"select-image":t(g).find(e+" .thumbs > [data-id]").removeClass("active"),t(g).find(e+` .thumbs > [data-id="${SBF.restoreJson(a)}"]`).addClass("active");break;case"repeater":let r=this.repeater("set",a,t(g).find(e+" .repeater-item:last-child"));""!=r&&t(g).find(e+" .sb-repeater").html(r);break;case"double-select":for(var n in a)t(g).find(`${e} .input > [data-id="${n}"] select`).val(a[n]);break;case"timetable":for(var n in a){let i=t(g).find(`${e} [data-day="${n}"] > div > div`);for(var o=0;o<i.length;o++)t(i[o]).attr("data-value",a[n][o][0]).attr("data-utc",!0).html(a[n][o][1])}}},repeater:function(e,i,s,a){if(t(s).find(".sb-icon-close").remove(),s=t(s).html(),"set"==e){var n="";if(i.length>0)for(var o=0;o<i.length;o++){let e=t.parseHTML(`<div>${s}</div>`);for(var r in i[o])this.setInput(t(e).find(`[data-id="${r}"]`),i[o][r]);n+=`<div class="repeater-item">${t(e).html()}<i class="sb-icon-close"></i></div>`}return n}if("get"==e){let e=[],s=this;return t(i).each(function(){let i={};t(this).find("[data-id]").each(function(){i[t(this).attr("data-id")]=s.getInput(this)}),void 0!==a?""!=i[a]&&(i.id=SBF.stringToSlug(i[a]),e.push(i)):e.push(i)}),e}},repeaterAdd:function(e){let i=t(e).parent();e=t.parseHTML(`<div>${t(i).find(".repeater-item:last-child").html()}</div>`),t(e).find("[data-id]").each(function(){C.resetInput(this)}),t(i).find(".sb-repeater").append(`<div class="repeater-item">${t(e).html()}</div>`)},repeaterDelete:function(e){t(e).parent().parent().find(".repeater-item").length>1&&t(e).parent().remove()},setInput:function(e,i){i=t.trim(i),t(e).is("select")?t(e).find(`option[value="${i}"]`).attr("selected",""):t(e).is("checkbox")&&i?t(e).attr("checked",""):t(e).is("textarea")?t(e).html(i):t(e).is("div")||t(e).is("i")||t(e).is("li")?t(e).attr("data-value",i):t(e).attr("value",i)},getInput:function(e){return t(e).is("checkbox")?t(e).is(":checked"):t(e).is("div")||t(e).is("i")||t(e).is("li")?t(e).attr("data-value"):t(e).val()},resetInput:function(e){t(e).is("select")?t(e).val("").find("[selected]").removeAttr("selected"):t(e).is("checkbox")&&value?t(e).removeAttr("checked").prop("checked",!1):t(e).is("textarea")?t(e).html(""):t(e).removeAttr("value").val("")},articles:function(e=""){let i=t(g).find(".sb-articles-area"),s=t(i).find(".sb-content").attr("data-article-id");if("save"==e&&-1!=s)for(var a=0;a<y.length;a++)if(y[a].id==s){y[a]={id:s,title:t(i).find(".sb-article-title input").val(),content:t(i).find(".sb-article-content textarea").val(),link:t(i).find(".sb-article-link input").val()};break}}},$={real_time:null,last_creation_time:!1,sorting:["creation_time","DESC"],user_types:["visitor","lead","user"],search_query:"",init:!1,filter:function(t){t="all"==t?["visitor","lead","user"]:"agent"==t?["agent","admin"]:[t],this.user_types=t,this.loading(),SBF.ajax({function:"online"==t?"get-online-users":"get-users",exclude_id:SB_CURRENT_AGENT.id,sorting:this.sorting,user_types:t,search:this.search_query},t=>{this.populate(t),this.loading(!1)})},sort:function(t,e="DESC"){this.sorting=[t,e],this.loading(),SBF.ajax({function:"get-users",exclude_id:-1,sorting:this.sorting,user_types:this.user_types,search:this.search_query},t=>{this.populate(t),this.loading(!1)})},search:function(e){SBF.search(e,()=>{this.loading(),SBF.ajax({function:e.length>1?"search-users":"get-users",search:e,user_types:this.user_types,sorting:this.sorting},i=>{this.user_types=["visitor","lead","user"],this.populate(i),this.search_query=e,this.loading(!1),t(p).find("li").sbActivate(!1).eq(0).sbActivate(),this.updateMenu()})})},populate:function(e){let i="";if(e.length)for(var s=0;s<e.length;s++)i+=this.getRow(new SBUser(e[s]));else i=`<p class="sb-no-results">${o("No users found.")}</p>`;t(f).find("tbody").html(i)},update:function(){if(0!=this.last_creation_time){let e=("user"==this.user_types[0]||"visitor"==this.user_types[0]||"lead"==this.user_types[0])&&""==this.search_query;SBF.ajax({function:"get-new-users",datetime:this.last_creation_time},i=>{let s=i.length;if(s>0){let n="";for(var a=0;a<s;a++){let t=new SBUser(i[a]);x[i[a]]=t,e&&(n+=this.getRow(t))}if(""!=n){let e=t(l).find(".sb-menu-users li.sb-active").data("type");t(f).find("tbody").prepend(n),$.updateMenu(),""!=(e="user"==e?'[data-user-type="visitor"], [data-user-type="lead"]':"visitor"==e?'[data-user-type="user"], [data-user-type="lead"]':"")&&t(f).find(e).remove()}this.last_creation_time=i[0].creation_time}})}},setUsersArray:function(){SBF.ajax({function:"get-users"},e=>{if(x={},e.length){for(var i=0;i<e.length;i++)x[e[i].id]=new SBUser(e[i]);this.last_creation_time=e[0].creation_time}t(document).trigger("sbUsersArraySetted")})},getRow:function(t){return t instanceof SBUser?`<tr data-user-id="${t.id}" data-user-type="${t.get("user_type")}"><td><input type="checkbox" /></td><td class="sb-td-profile"><a class="sb-profile"><img src="${t.get("profile_image")}" /><span>${t.get("full_name")}</span></a></td><td class="sb-td-email">${t.get("email")}</td><td class="sb-td-ut">${t.get("user_type")}</td><td>${SBF.beautifyTime(t.get("last_activity"))}</td><td>${t.get("creation_time")}</td></tr>`:(SBF.error("User not of type SBUser","SBUsers.getRow"),!1)},updateRow:function(e){let i=t(f).find(`[data-user-id="${e.id}"]`);if(i.length){let s=t(l).find(".sb-menu-users"),a=t(s).find(".sb-active").data("type"),n=e.get("user_type");if(n==a||"admin"==n&&"agent"==a||"all"==a)t(i).replaceWith(this.getRow(e));else{let e=t(l).find(`[data-type="${"admin"==n?"agent":n}"] span`),s=parseInt(t(e).attr("data-count"));t(e).html(s+1).attr("data-count",s+1),t(i).remove()}}else t(f).find("tbody").append(this.getRow(e));this.updateMenu()},updateMenu:function(){let e=t(l).find(".sb-menu-users"),i=["user","lead","visitor"],s=t(e).find(".sb-active").data("type"),a={};if("all"==s)for(n=0;n<i.length;n++)a[i[n]]=t(f).find(`[data-user-type="${i[n]}"]`).length;else{for(n=0;n<i.length;n++)a[i[n]]=parseInt(t(e).find(`[data-type="${i[n]}"] span`).attr("data-count"));a[s]=t(f).find(`[data-user-type="${s}"]`).length}t(e).find('[data-type="all"] span').html(`(${a.user+a.lead+a.visitor})`).attr("data-count",a.user+a.lead+a.visitor);for(var n=0;n<i.length;n++)t(e).find(`[data-type="${i[n]}"] span`).html(`(${a[i[n]]})`).attr("data-count",a[i[n]])},delete:function(e){this.loading(),Array.isArray(e)?SBF.ajax({function:"delete-users",user_ids:e},()=>{for(var s=0;s<e.length;s++)delete x[e[s]],t(f).find(`[data-user-id="${e[s]}"]`).remove(),t(u).find(`[data-user-id="${e[s]}"]`).remove();i("Users deleted"),this.updateMenu(),this.loading(!1)}):x[e].delete(()=>{s().id==e&&s(!1),delete x[e],t(f).find(`[data-user-id="${e}"]`).remove(),t(u).find(`[data-user-id="${e}"]`).remove(),t(l).sbHideLightbox(),i("User deleted"),this.updateMenu(),this.loading(!1)})},startRealTime:function(){this.stopRealTime(),this.real_time=setInterval(()=>{this.update()},1e3)},stopRealTime:function(){clearInterval(this.real_time)},loading:function(e=!0){let i=t(l).find(".sb-area-users .sb-loading");e?t(i).sbActivate():t(i).sbActivate(!1)},csv:function(){SBF.ajax({function:"csv-users"},t=>window.open(t))},updateCurrentAgent:function(e,i,s,a){SBF.ajax({function:"update-login",profile_image:e,first_name:i,last_name:s,email:a},t=>{0!=t&&Array.isArray(t)&&storage("login",t[1])}),SB_CURRENT_AGENT.full_name=i+" "+s,SB_CURRENT_AGENT.profile_image=e,F.populateHeader(t(c).find(".sb-account"),SB_CURRENT_AGENT.full_name,SB_CURRENT_AGENT.profile_image)}},T={real_time:null,datetime_last_conversation:["2000-01-01 00:00:00",new Date("2000-01-01 00:00:00")],user_typing:!1,desktop_notifications:!1,flash_notifications:!1,open:function(e=-1,i){-1!=e&&this.populate(e,i,!0),t(l).sbHideLightbox(),t(c).find(".sb-admin-nav a").sbActivate(!1).parent().find("#sb-messages").sbActivate(),t(l).find(" > main > div").sbActivate(!1),t(d).sbActivate().find(".sb-board").removeClass("sb-no-conversation"),this.startRealTime()},populate:function(i,a,n=!1){SBF.null(x[a])?(s(new SBUser({id:a})),s().update(()=>{x[a]=s(),this.updateUserDetails()})):s(x[a]),-1!=i?s().getFullConversation(i,e=>{SBChat.setConversation(e),SBChat.populate(),t(d).find(".sb-top > a").html(e.get("title")),n&&(t(d).find(`[data-conversation-id="${i}"]`).sbActivate(),this.scrollTo()),t(d).find('.sb-top [data-value="read"]').sbActivate(2==e.get("conversation_status_code"))}):(SBChat.clear(),t(u).find("li").sbActivate(!1)),this.updateUserDetails(),s().getConversations(function(e){t(d).find(".sb-user-conversations").html(s().getConversationsCode(e))},i),t(d).find(".sb-board").removeClass("sb-no-conversation"),e(),this.startRealTime(),SBChat.email_sent=!1},populateList:function(e){let i=["",""];k=[];for(var s=0;s<e.length;s++){let t=new Date(e[s].creation_time);this.datetime_last_conversation[1]<t&&(this.datetime_last_conversation=[e[s].creation_time,t]);let n=e[s].message.length;if(n>114&&(e[s].message=e[s].message.substr(0,114)+" ..."),0==n&&!SBF.null(e[s].attachments)){let t=JSON.parse(e[s].attachments),i="";if(Array.isArray(t)){for(var a=0;a<t.length;a++)i+=t[a][0]+" ";i.length>114&&(cod2e=i.substr(0,114)+" ..."),e[s].message=i}}i[2==e[s].conversation_status_code?0:1]+=this.getListCode(e[s]),k.push(e[s])}i[0]+i[1]==""&&(i[0]=`<p class="sb-no-results">${o("No conversations found.")}</p>`),t(u).html(i[0]+i[1]),this.updateMenu()},update:function(){SBF.ajax({function:"get-new-conversations",datetime:this.datetime_last_conversation[0]},e=>{if(e.length){let a,n="",r="",l=0!=SBChat.conversation?SBChat.conversation.id:-1,c=!1;this.datetime_last_conversation=[e[0].creation_time,new Date(e[0].creation_time)];for(var i=0;i<e.length;i++){let f=e[i],p=f.conversation_status_code,h=f.conversation_id,b=l==h,g=this.getListCode(f,null,!b),v=t(u).find(`[data-conversation-id="${h}"]`),m=v.index(),_=v.length,y=SBF.null(e[i].payload)?{}:JSON.parse(e[i].payload);if(b?(g=g.replace("<li",'<li class="sb-active"'),_?(t(v).replaceWith(g),k[m].conversation_status_code=p,t(d).find('.sb-top [data-value="read"]').sbActivate(2==p)):c=!0):_&&(k[m]=f,t(u).find(`[data-conversation-id="${h}"]`).remove()),f.user_id in x||(x[f.user_id]=new SBUser({id:f.user_id,first_name:f.first_name,last_name:f.last_name,profile_image:f.profile_image,user_type:f.user_type})),b&&0!=_||(2==p?(n+=g,k.unshift(f)):0!=p&&1!=p||(0==(a=t(u).find('[data-conversation-status="2"]').last()).length?n+=g:(k.splice(a.index()+1,0,f),r+=g))),"event"in y&&"update-user"==y.event&&s().update(()=>{this.updateUserDetails()}),!SBChat.tab_active&&!SBF.isAgent(f.message_user_type)){if(this.desktop_notifications)if("granted"!==Notification.permission)Notification.requestPermission();else{new Notification(f.first_name+" "+f.last_name,{body:f.message,icon:f.profile_image}).onclick=(()=>{window.focus()})}this.flash_notifications&&(document.title=o("New message ..."))}}""!=n&&t(u).prepend(n),""!=r&&t(r).insertAfter(a),c&&this.scrollTo(),this.updateMenu()}})},updateMenu:function(){t(d).find(".sb-admin-list .sb-select > p span").html("("+t(u).find('[data-conversation-status="2"]').length+")")},updateUserDetails(){t(d).find(`[data-user-id="${s().id}"] .sb-name,.sb-top > a`).html(s().get("full_name")),F.populateHeader(t(d).find(".sb-user-details .sb-profile")),F.populate(s(),t(d).find(".sb-profile-list"))},getListCode:function(t,e,i=!1){return SBF.null(e)&&(e=t.conversation_status_code),`<li data-user-id="${t.user_id}" data-conversation-id="${t.conversation_id}" data-conversation-status="${e}">`+(i&&2==e?"<span>"+o("New")+"</span>":"")+`<div class="sb-profile"><img src="${t.profile_image}"><span class="sb-name">${t.first_name} ${t.last_name}</span><span class="sb-time">${SBF.beautifyTime(t.creation_time)}</span></div><p>${t.message}</p></li>`},startRealTime:function(){this.stopRealTime(),this.real_time=setInterval(()=>{this.update(),this.updateCurrentURL()},1e4),SBChat.startRealTime()},stopRealTime:function(){clearInterval(this.real_time),SBChat.stopRealTime()},csv:function(t=-1){SBF.ajax({function:"csv-conversations",conversation_id:t},t=>window.open(t))},typing:function(e){e?SBChat.user_online&&!this.user_typing&&(t(d).find(".sb-conversation .sb-top > .sb-labels").append('<span class="sb-status-typing">'+o("Typing")+"</span>"),this.user_typing=!0):this.user_typing&&(t(d).find(".sb-conversation .sb-top .sb-status-typing").remove(),this.user_typing=!1)},scrollTo:function(){let e=t(u).find(".sb-active"),i=e.length?t(e)[0].offsetTop:0;t(u).parent().scrollTop(i-(w?120:70))},search:function(e){SBF.search(e,()=>{e.length>1?SBF.ajax({function:"search-conversations",search:e},t=>{T.populateList(t),this.scrollTo()}):(S=0,SBF.ajax({function:"get-conversations",pagination:0,status:t(d).find(".sb-admin-list .sb-select li.sb-active").data("value")},t=>{T.populateList(t)}))})},updateCurrentURL:function(){if(SBChat.user_online&&0!=s()){let e=t(d).find('.sb-profile-list [data-id="current_url"] label');e.length&&SBF.ajax({function:"current-url"},i=>{0!=i&&t(e).attr("data-url",i).html(i.replace("https://","").replace("http://","").replace(/\/$/,""))})}},showDialogflowIntent:function(e){let i=t(l).find(".sb-dialogflow-intent-box"),s=SBChat.conversation.messages,a="",n="";for(var o=s.length-1;o>0;o--)if(s[o].id==e){n=s[o].get("message");for(var r=o-1;r>-1;r--)if(!SBF.isAgent(s[r].get("user_type"))){a=s[r].get("message");break}break}t(i).find(".sb-type-text:not(.sb-first)").remove(),t(i).find("input").val(a),t(i).find("textarea").val(n),t(i).sbShowLightbox()},sendDialogflowIntent:function(e){if(!t(e).sbLoading()){t(e).sbLoading(!0);let s=t(l).find(".sb-dialogflow-intent-box"),a=[],n=t(s).find("textarea").val();t(s).find(".sb-type-text input").each(function(){""!=t(this).val()&&a.push(t(this).val())}),""==n||0==a.length?SBForm.showErrorMessage(s,"Please insert the bot response and at least one user expression."):SBF.ajax({function:"dialogflow-intent",expressions:a,response:n,agent_language:t(s).find(".sb-dialogflow-languages select").val()},a=>{if(!0===a)t(l).sbHideLightbox(),i("Intent created");else{let t="Error";"error"in a&&"message"in a.error&&(t=a.error.message),SBForm.showErrorMessage(s,t)}t(e).sbLoading(!1)})}},mobileOpenConversation(){t(d).find(".sb-admin-list").sbActivate(!1),t(d).find(".sb-conversation").sbActivate(),t(c).addClass("sb-hide")},mobileCloseConversation(){t(u).find("li.sb-active").sbActivate(!1),t(d).find(".sb-admin-list").sbActivate(),t(d).find(".sb-conversation").sbActivate(!1),t(c).removeClass("sb-hide")}},F={getAll:function(t){return SBForm.getAll(t)},get:function(t){return SBForm.get(t)},set:function(t,e){return SBForm.set(t,e)},show:function(e){n(),s(new SBUser({id:e})),s().update(()=>{this.populate(s(),t(h).find(".sb-profile-list")),this.populateHeader(t(h).find(".sb-profile")),s().getConversations(e=>{let i=s().get("user_type");SBF.isAgent(i)&&this.agentData(),t(h).find(".sb-user-conversations").html(s().getConversationsCode(e)),t(h).removeClass("sb-type-agent sb-type-lead sb-type-user sb-type-visitor").addClass(`sb-type-${i}`).attr("data-user-id",s().id).sbShowLightbox(),n(!1,!1)}),x[e]=s()})},showEdit:function(e){if(!(e instanceof SBUser))return SBF.error("User not of type SBUser","SBUsers.showEdit"),!1;{let i=t(b).find("#password input"),s=e.get("user_type"),a=t(b).find("#user_type select"),n=t(b).find("#email input");t(b).removeClass("sb-user-new").attr("data-user-id",e.id),t(b).find(".sb-top-bar .sb-save").html(`<i class="sb-icon-check"></i>${o("Save changes")}`),this.populateEdit(e,b),this.populateHeader(t(b).find(".sb-profile")),"visitor"==s||"lead"==s?t(n).removeAttr("required"):t(n).prop("required",!0),"admin"==SB_CURRENT_AGENT.user_type&&SBF.isAgent(s)?(t(a).html('<option value="agent">Agent</option><option value="admin"'+("admin"==s?" selected":"")+">Admin</option>"),t(a).parent().show()):t(a).parent().hide(),""!=t(i).val()&&t(i).val("********"),t(b).sbShowLightbox()}},populate:function(e,i){let s=["first_name","last_name","password","profile_image"],a="";"admin"!=SB_CURRENT_AGENT.user_type&&s.push("token");for(var n in e.details)s.includes(n)||(a+=this.profileRow(n,e.get(n)));if(e.isExtraEmpty())SBF.ajax({function:"get-user-extra",user_id:e.id},s=>{for(var n=0;n<s.length;n++){let t=s[n].slug;e.setExtra(t,s[n]),a+=this.profileRow(t,s[n].value,s[n].name)}t(i).html(`<ul>${a}</ul>`)});else{for(var n in e.extra){let t=e.getExtra(n);a+=this.profileRow(n,t.value,t.name)}t(i).html(`<ul>${a}</ul>`)}},profileRow:function(t,e,i=t){if(""==e)return"";let s={id:"padlock",full_name:"user",email:"envelope",user_type:"user",last_activity:"reload",creation_time:"calendar",token:"shuffle",currency:"currency",browser_language:"language",browser:"smartphone",ip:"internet",location:"marker",country:"marker",os:"desktop",current_url:"next",timezone:"clock"};switch(t){case"last_activity":case"creation_time":e=SBF.beautifyTime(e);break;case"user_type":e=SBF.slugToString(e)}return`<li data-id="${t}"><i class="sb-icon sb-icon-${t in s?s[t]:"plane"}"></i><span>${SBF.slugToString(i)}</span><label>${e}</label></li>`},populateEdit:function(e,i){t(i).find(".sb-details .sb-input").each((i,s)=>{this.set(s,e.details[t(s).attr("id")])}),t(i).find(".sb-additional-details .sb-input").each((i,s)=>{let a=t(s).attr("id");a in e.extra?this.set(s,e.extra[a].value):this.set(s,"")})},clear:function(t){SBForm.clear(t)},populateHeader:function(e,i=!1,a=!1){0==i&&(i=s().get("full_name")),0==a&&(a=s().get("profile_image")),t(e).find("img").attr("src",a),t(e).find("span").html(i)},errors:function(e){return SBForm.errors(t(e).find(".sb-details"))},showErrorMessage:function(t,e){SBForm.showErrorMessage(t,e)},agentData:function(){let e=`<div class="sb-title">${o("Conversations rating")}</div><div class="sb-rating-area sb-loading"></div>`,i=t(h).find(".sb-agent-area");t(i).html(e),SBF.ajax({function:"get-rating"},s=>{if(0==s[0]&&0==s[1])e=`<p class="sb-no-results">${o("No ratings yet.")}</p>`;else{let t=s[0]+s[1],i=100*s[0]/t,a=100*s[1]/t;e=`<div><div>${o("Positive")}</div><span data-count="${s[0]}" style="width: ${Math.round(2*i)}px"></span><div>${i.toFixed(2)} %</div></div><div><div>${o("Negative")}</div><span data-count="${s[1]}" style="width: ${Math.round(2*a)}px"></span><div>${a.toFixed(2)} %</div></div><p class="sb-rating-count">${t} ${o("Ratings")}</p>`}t(i).find(".sb-rating-area").html(e).sbLoading(!1)})}};t(document).ready(function(){if(l=t(".sb-admin"),c=t(l).find("> .sb-header"),d=t(l).find(".sb-area-conversations"),u=t(d).find(".sb-admin-list .sb-scroll-area ul"),f=t(l).find(".sb-table-users"),p=t(l).find(".sb-menu-users"),h=t(l).find(".sb-profile-box"),b=t(l).find(".sb-profile-edit-box"),g=t(l).find(".sb-area-settings"),l.length)if(t(l).removeAttr("style"),(window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone||document.referrer.includes("android-app://"))&&t(l).addClass("sb-pwa"),A&&r(),"undefined"!=typeof SB_ADMIN_SETTINGS)t(window).keydown(function(e){let i=e.which;if([46,27,13].includes(i)){let s=t(l).find(".sb-dialog-box");if(t(s).sbActive())switch(i){case 46:case 27:t(s).find(".sb-cancel").click(),e.preventDefault();break;case 13:t(s).find("info"!=t(s).attr("data-type")?".sb-confirm":".sb-close").click(),e.preventDefault()}}}),t(l).find(" > .sb-rich-login").length?t(l).addClass("sb-admin-start"):(t(c).on("click",".sb-version",function(){let e=t(l).find(".sb-updates-box");SBF.ajax({function:"get-versions"},i=>{let s="",a={sb:"Support Board",slack:"Slack",dialogflow:"Dialogflow"},r=!1;for(var l in i){let t=SB_VERSIONS[l]==i[l];t||(r=!0),-1!=SB_VERSIONS[l]&&(s+=`<div class="sb-input"><span>${a[l]}</span><div${t?' class="sb-green"':""}>${o(t?"You are running the latest version.":"Update available, please update now.")} ${o("Your version is")} V ${SB_VERSIONS[l]}</div></div>`)}r?t(e).find(".sb-update").removeClass("sb-hide"):t(e).find(".sb-update").addClass("sb-hide"),n(!1),t(e).find(".sb-main").prepend(s),t(e).sbShowLightbox()}),n(!0),t(e).sbActivate(!1),t(e).find(".sb-input").remove()}),t(l).on("click",".sb-updates-box .sb-update",function(){let e=t(l).find(".sb-updates-box");t(this).sbLoading()||(SBF.ajax({function:"update"},i=>{let s="";if("envato-purchase-code-not-found"==i)s="Please go to Settings > Various and insert the Envato Purchase Code.";else{let t=!0;for(var a in i)if("success"!=i[a]){t=!1;break}t||(s=JSON.stringify(i))}""==s?(r(),location.reload()):SBForm.showErrorMessage(e,s),t(this).sbLoading(!1)}),t(this).sbLoading(!0))}),setTimeout(function(){if(SB_ADMIN_SETTINGS["auto-updates"]){let t=SBF.storage("last-update-check"),e=new Date,s=[e.getMonth(),e.getDate()];(0==t||s[0]!=t[0]||s[1]>t[1]+10)&&(SBF.storage("last-update-check",s),SBF.ajax({function:"update"},t=>{"string"==typeof t||Array.isArray(t)||(i("Automatic update complete. Reload the page to apply the update."),r())}))}},1e3),t(l).on("click",".sb-apps > div",function(){let e=t(l).find(".sb-app-box"),i=t(this).data("app");SBF.ajax({function:"app-get-key",app_name:i},i=>{t(e).find("input").val(i)}),t(e).find("input").val(""),t(e).find(".sb-top-bar > div:first-child").html(t(this).find("h2").html()),t(e).find("p").html(t(this).find("p").html()),t(e).attr("data-app",i),t(e).find(".sb-btn-app-puchase").attr("href","https://board.support/shop/"+i),t(e).find(".sb-btn-app-details").attr("href","https://board.support/"+i),t(e).sbShowLightbox()}),t(l).on("click",".sb-app-box .sb-activate",function(){let e=t(l).find(".sb-app-box"),s=t(e).find("input").val(),a="";""!=s?t(this).sbLoading()||(SBF.ajax({function:"app-activation",app_name:t(e).attr("data-app"),key:s},s=>{"invalid-key"==s?a="Looks like your license key is invalid. If you think this is an error contact the support.":"expired"==s?a="Your license key is expired, please buy a new licence. If you think this is an error contact the support.":"success"!=s&&(a="Error: "+s),""==a?(i("Activation completed! Reloading in progress ..."),setTimeout(function(){location.reload()},1e3)):(SBForm.showErrorMessage(e,a),t(this).sbLoading(!1))}),t(this).sbLoading(!0)):SBForm.showErrorMessage(e,"Please insert the license key.")}),"undefined"==typeof Notification||"all"!=SB_ADMIN_SETTINGS["desktop-notifications"]&&"agents"!=SB_ADMIN_SETTINGS["desktop-notifications"]||(T.desktop_notifications=!0),"all"!=SB_ADMIN_SETTINGS["flash-notifications"]&&"agents"!=SB_ADMIN_SETTINGS["flash-notifications"]||(T.flash_notifications=!0),setTimeout(function(){SBF.ajax({function:"clean-data"})},5e3),w&&(t(l).on("click",".sb-menu-mobile > i",function(){t(this).toggleClass("sb-active")}),t(l).on("click",".sb-menu-mobile a",function(){t(this).closest(".sb-menu-mobile").find(" > i").sbActivate(!1)}),t(l).on("click",".sb-menu-wide",function(){t(this).toggleClass("sb-active")}),t(l).find(".sb-admin-list .sb-scroll-area, main > div > .sb-scroll-area").on("scroll",function(){let e=t(this).scrollTop();B.last<e-10&&B.header?(t(l).addClass("sb-header-hidden"),B.header=!1):B.last>e+10&&!B.header&&!B.always_hidden&&(t(l).removeClass("sb-header-hidden"),B.header=!0),B.last=e}),t(l).on("click",".sb-search-btn i",function(){t(this).parent().sbActive()?(t(l).addClass("sb-header-hidden"),B.always_hidden=!0):(B.always_hidden=!1,t(u).parent().scrollTop()<10&&t(l).removeClass("sb-header-hidden"))}),t(d).on("click",".sb-top .sb-btn-back",function(){T.mobileCloseConversation()}),t(f).find("th:first-child").html(o("Order by")),t(f).on("click","th:first-child",function(){t(this).parent().toggleClass("sb-active")})),t(c).on("click"," .sb-admin-nav a",function(){let e=t(this).attr("id");t(c).find(".sb-admin-nav a").sbActivate(!1),t(l).find(" > main > div").sbActivate(!1).eq(t(this).index()).sbActivate(),t(this).sbActivate(),SBF.deactivateAll(),"sb-messages"==e?(w||t(u).find("li:first-child").click(),T.update(),T.startRealTime(),$.stopRealTime()):"sb-users"==e?($.startRealTime(),T.stopRealTime(),$.init||(n(),SBF.ajax({function:"get-users",user_types:["user","visitor","lead"]},t=>{$.populate(t),$.updateMenu(),$.init=!0,n(!1)}))):"sb-settings"==e&&(C.init||(n(),SBF.ajax({function:"get-all-settings"},t=>{for(var e in t)C.set(e,t[e]);C.initPlugins(),C.init=!0,n(!1)})),$.stopRealTime(),T.stopRealTime())}),t(c).on("click",".sb-profile",function(){t(this).next().toggleClass("sb-active")}),t(c).on("click",'[data-value="logout"],.logout',function(){$.stopRealTime(),T.stopRealTime(),SBF.logout()}),t(c).on("click",'[data-value="edit-profile"],.edit-profile',function(){n();let e=new SBUser({id:SB_CURRENT_AGENT.id});e.update(()=>{t(c).find(".sb-admin-nav #sb-users").click(),s(e),n(!1),F.showEdit(e)})}),F.populateHeader(t(c).find(".sb-account"),SB_CURRENT_AGENT.full_name,SB_CURRENT_AGENT.profile_image),setInterval(function(){e()},1e4),n(),t(document).on("sbUsersArraySetted",function(){SBF.ajax({function:"get-conversations",pagination:S},e=>{0==e.length&&t(d).find(".sb-board").addClass("sb-no-conversation"),T.populateList(e),w?t(d).find(".sb-admin-list").sbActivate():t(u).find("li:first-child").click(),T.startRealTime(),n(!1)})}),t(u).on("click","li",function(){T.populate(t(this).attr("data-conversation-id"),t(this).attr("data-user-id")),t(this).siblings().sbActivate(!1),t(this).sbActivate(),w&&T.mobileOpenConversation(),setTimeout(()=>{t(this).find(" > span").remove()},3e3)}),t(l).on("click",".sb-user-conversations li",function(){let e=t(this).attr("data-conversation-id"),i=t(this).attr("data-conversation-status"),a=t(d).find(".sb-admin-list .sb-select");T.populate(e,s().id),i=1==i||2==i?0:i,t(a).find(".sb-active").attr("data-value")!=i?(t(a).find(`[data-value="${i}"]`).click(),t(a).find("ul").sbActivate(!1)):(t(u).find("li").sbActivate(!1),t(u).find(`[data-conversation-id="${e}"]`).sbActivate()),SBChat.email_sent=!1}),t(d).on("click",".sb-top ul a",function(){let e=-1,i="The conversation will be ",s=t(this).attr("data-value"),n=SBChat.conversation.id;switch(s){case"inbox":e=0,i+="restored.";break;case"archive":i+="archived.",e=3;break;case"delete":i+="deleted.",e=4;break;case"empty-trash":e=5,i="All the conversations in the trash, including their messages, will be deleted permanently.";break;case"csv":T.csv(n);break;case"read":e=0,i+="marked as read."}-1!=e&&a(i,"alert",function(){SBF.ajax({function:"update-conversation-status",conversation_id:n,status:e},()=>{if([0,3,4].includes(e))for(var i=0;i<k.length;i++)if(k[i].conversation_id==n){k[i].conversation_status_code=e;break}"read"==s?(t(u).find(".sb-active").attr("data-conversation-status",0),t(d).find('.sb-top [data-value="read"]').sbActivate(!1)):(t(d).find(".sb-admin-list .sb-select li.sb-active").click(),t(d).find(".sb-admin-list .sb-select ul").sbActivate(!1))})})}),SBChat.initEditorBoxes(),t(document).on("SBMessageDeleted",function(){let e=SBChat.conversation.getLastMessage();0!=e?t(u).find("li.sb-active p").html(e.get("message")):(t(u).find("li.sb-active").remove(),t(u).find("li:first-child").click(),T.scrollTo())}),t(document).on("SBMessageSent",function(e,i){let s=t(u).find(`[data-conversation-id="${i.conversation_id}"]`);t(s).find("p").html(i.message),-1!=i.conversation_status&&(t(s).attr("data-conversation-status",i.conversation_status),T.updateMenu())}),t(document).on("SBChatNewMessages",function(e,i){setTimeout(function(){t(d).find(".sb-conversation .sb-top .sb-status-typing").remove()},300),T.update()}),t(document).on("SBChatNewConversationCreated",function(){T.update()}),t(d).find(".sb-admin-list .sb-search-btn input").on("input",function(){T.search(t(this).val())}),t(d).on("click",".sb-admin-list .sb-search-btn i",function(){SBF.searchClear(this,function(){T.search("")})}),t(d).on("click",".sb-admin-list .sb-select li",function(){let e=t(this).data("value");SBF.ajax({function:"get-conversations",pagination:S,status:e},i=>{if(T.populateList(i),t(d).find(".sb-conversation").attr("data-conversation-status",e),i.length){if(!w){let e=!0;if(0!=SBChat.conversation){let i=t(u).find(`[data-conversation-id="${SBChat.conversation.id}"]`);i.length&&(t(i).sbActivate(),e=!1)}e&&t(u).find("li:first-child").click(),T.scrollTo()}}else t(d).find(".sb-board").addClass("sb-no-conversation")})}),t(document).on("SBTyping",function(t,e){T.typing(e)}),t(d).on("click",".sb-user-details .sb-scroll-area > .sb-profile,.sb-top > a",function(){let e=t(u).find(".sb-active").attr("data-user-id");s().id!=e&&s(x[e]),F.show(s().id)}),t(l).on("click",'.sb-profile-list [data-id="location"]',function(){a('<iframe src="https://maps.google.com/maps?q='+t(this).find("label").html().replace(", ","+")+'&output=embed"></iframe>',"map")}),t(l).on("click",'.sb-profile-list [data-id="timezone"]',function(){n();let e=t(this).find("label").html(),i=e.split("/");SBF.cors("GET","https://worldtimeapi.org/api/timezone/"+e,function(t){t=JSON.parse(t),!SBF.null(t)&&SBF.null(t.error)||a("We can not find this timezone. Error details:"+t.error,"info");let e=t.datetime.replace("T"," ");n(!1),a(`${o("The date and time in")} ${i[1].replace("_"," ")}, ${i[0].replace("_"," ")} is ${new Date(e.substr(0,e.indexOf("."))).toLocaleString()}`,"info")})}),t(l).on("click",'.sb-profile-list [data-id="current_url"]',function(){let e=t(this).find("label");window.open(SBF.null(t(e).attr("data-url"))?t(e).html():t(e).attr("data-url"))}),t(d).on("click",'.sb-menu [data-value="bot"]',function(){T.showDialogflowIntent(t(this).closest("[data-id]").attr("data-id"))}),t(l).on("click",".sb-dialogflow-intent-box .sb-intent-add i",function(){t(l).find(".sb-dialogflow-intent-box .sb-type-text").last().after('<div class="sb-input-setting sb-type-text"><input type="text"></div>')}),t(l).on("click",".sb-dialogflow-intent-box .sb-send",function(){T.sendDialogflowIntent(this)}),$.setUsersArray(),t(f).on("click","th :checkbox",function(){t(f).find("td :checkbox").prop("checked",t(this).prop("checked"))}),t(f).on("click",":checkbox",function(){let e=t(l).find('.sb-area-users [data-value="delete"]');t(f).find("td input:checked").length?t(e).removeAttr("style"):t(e).hide()}),t(p).on("click","li",function(){$.filter(t(this).data("type"))}),t(l).on("input",".sb-area-users .sb-search-btn input",function(){$.search(t(this).val())}),t(l).on("click",".sb-area-users .sb-search-btn i",function(){SBF.searchClear(this,function(){$.search("")})}),t(f).on("click","th:not(:first-child)",function(){let e=t(this).hasClass("sb-order-asc")?"DESC":"ASC";t(this).toggleClass("sb-order-asc"),t(this).siblings().sbActivate(!1),t(this).sbActivate(!0),$.sort(t(this).data("field"),e)}),t(l).on("click",'.sb-area-users [data-value="csv"]',function(){$.csv()}),t(b).on("click",".sb-delete",function(){a("You will delete the user and all linked data including conversations and messages.","alert",function(){$.delete(s().id)})}),t(l).on("click",'.sb-area-users [data-value="delete"]',function(){a("You will delete all the selected users and all linked data including conversations and messages.","alert",()=>{let e=[];t(f).find("tr").each(function(){t(this).find('td input[type="checkbox"]').is(":checked")&&e.push(t(this).attr("data-user-id"))}),$.delete(e),t(this).hide(),t(f).find("th:first-child input").prop("checked",!1)})}),t(f).on("click","td:not(:first-child)",function(){F.show(t(this).parent().attr("data-user-id"))}),t(h).on("click",".sb-top-bar .sb-edit",function(){F.showEdit(s())}),t(l).on("click",".sb-area-users .sb-new-user",function(){t(b).addClass("sb-user-new"),t(b).find(".sb-top-bar .sb-profile span").html(o("Add new user")),t(b).find(".sb-top-bar .sb-save").html(`<i class="sb-icon-check"></i>${o("Add user")}`),t(b).find("#email input").prop("required",!0),"admin"==SB_CURRENT_AGENT.user_type?t(b).find("#user_type").show().find("select").html('<option value="user">User</option><option value="agent">Agent</option><option value="admin">Admin</option>'):t(b).find("#user_type").hide(),F.clear(b),t(b).sbShowLightbox()}),t(b).on("click",".sb-save",function(){let e=!!t(b).hasClass("sb-user-new"),a=t(b).attr("data-user-id");if(!t(this).sbLoading()){t(this).sbLoading(!0);let n=F.getAll(t(b).find(".sb-details")),o=F.getAll(t(b).find(".sb-additional-details"));if(F.errors(b))return F.showErrorMessage(b,"user"==t(b).find("#user_type :selected").val()?"First name, Last name and a valid Email are required.":"First name and Last name are required."),void t(this).sbLoading(!1);SBF.ajax({function:e?"add-user":"update-user",user_id:a,settings:n,settings_extra:o},o=>{if("duplicate-email"==o)return F.showErrorMessage(b,"The email is already in use."),void t(this).sbLoading(!1);e?(a=o,s(new SBUser({id:a}))):a==SB_CURRENT_AGENT.id&&$.updateCurrentAgent(n.profile_image[0],n.first_name[0],n.last_name[0],n.email[0]),s().update(()=>{x[a]=s(),e?(F.clear(b),$.update()):($.updateRow(s()),t(d).sbActive()&&T.updateUserDetails()),t(this).sbLoading(!1),F.populateHeader(t(b).find(".sb-profile")),i(e?"New user added":"User updated")}),t(document).trigger("SBUserUpdated",{new_user:e,user_id:a})})}}),t(b).on("change","#user_type",function(){let e=t(b).find("#email input");"visitor"==t(this).find("option:selected").val()?t(e).removeAttr("required"):t(e).prop("required",!0)}),t(h).on("click",".sb-user-conversations li",function(){T.open(t(this).attr("data-conversation-id"),s().id)}),t(h).on("click",".sb-start-conversation",function(){T.open(-1,s().id),T.populate(-1,s().id)}),t(g).on("click",'[data-type="upload-image"]',function(){v=this,t(l).find(".sb-upload-form-admin .sb-upload-files").click()}),t(g).on("click",'[data-type="upload-image"] .image > i',function(e){return t(this).parent().removeAttr("data-url").css("background-image",""),e.preventDefault(),!1}),t(g).on("click",".sb-repeater-add",function(){C.repeaterAdd(this)}),t(g).on("click",".repeater-item > i",function(){C.repeaterDelete(this)}),t(g).find(".sb-type-color input").colorPicker({renderCallback:function(e,i){t(e.context).closest(".input").find("input").css("background-color",e.text)}}),t(g).find('[data-save="color"]').focusout(function(){let e=t(this).closest(".input-color"),i=t(e).find("input").val();setTimeout(function(){t(e).find("input").val(""),t(e).find(".color-preview").css("background-color",i)},300),C.set(t(this).attr("id"),i)}),t(g).on("click",".sb-type-color .input i",function(e){t(this).parent().find("input").removeAttr("style").val("")}),t(g).on("click",".sb-save-changes",function(){C.save(this)}),t(g).on("click",".sb-top-bar .sb-menu-wide li",function(){t(g).find(" > .sb-scroll-area > div").sbActivate(!1).eq(t(this).index()).sbActivate()}),t(g).on("change",'#user-additional-fields [data-id="extra-field-slug"], #saved-replies [data-id="reply-name"], [data-id="rich-message-name"]',function(){t(this).val(SBF.stringToSlug(t(this).val()))}),t(g).find("#dialogflow-button .sb-btn").attr("href","https://board.support/synch/?service=dialogflow&plugin_url="+SB_URL),t(g).on("click","#test-email-user .sb-btn, #test-email-agent .sb-btn",function(){let e=t(this).parent().find("input").val();""!=e&&e.indexOf("@")>0&&!t(this).sbLoading()&&(t(this).sbLoading(!0),SBF.ajax({function:"send-test-email",to:e,email_type:"test-email-user"==t(this).parent().parent().attr("id")?"user":"agent"},()=>{a("Email successfully sent. Check your emails!","info"),t(this).sbLoading(!1)}))}),t(g).on("click",".sb-timetable > div > div > div",function(){let e=t(this).closest(".sb-timetable"),i=t(this).sbActive();if(t(e).find(".sb-active").sbActivate(!1),i)t(this).sbActivate(!1).find(".sb-custom-select").remove();else{let i=t(e).find("> .sb-custom-select").html();t(e).find(" > div .sb-custom-select").remove(),t(this).append(`<div class="sb-custom-select">${i}</div>`).sbActivate(!0)}}),t(g).on("click",".sb-timetable .sb-custom-select span",function(){let e=[t(this).html(),t(this).attr("data-value")];t(this).closest(".sb-timetable").find("> div > div > .sb-active").html(e[0]).attr("data-value",e[1]).removeAttr("data-utc"),t(this).parent().sbActivate(!1)}),t(g).find("#slack-button .sb-btn").attr("href","https://board.support/synch/?service=slack&plugin_url="+SB_URL),t(g).on("click","#slack-test .sb-btn",function(e){t(this).sbLoading()||(t(this).sbLoading(!0),SBF.ajax({function:"send-slack-message",user_id:-1,full_name:SB_CURRENT_AGENT.full_name,profile_image:SB_CURRENT_AGENT.profile_image,message:"Lorem ipsum dolor sit amete consectetur adipiscing elite incidido labore et dolore magna aliqua.",attachments:[["Example link",SB_URL+"/media/user.svg"],["Example link two",SB_URL+"/media/user.svg"]]},e=>{Array.isArray(e)&&"success"==e[0]?a("Slack message successfully sent. Check Slack!","info"):a("Error. Response: "+JSON.stringify(e),"info"),t(this).sbLoading(!1)})),e.preventDefault()}),t(g).on("click","#tab-slack",function(){let e=t(g).find("#slack-agents .input");t(e).html('<div class="sb-loading"></div>'),SBF.ajax({function:"slack-users"},i=>{let s="";if("slack-token-not-found"==i)s=`<p>${o("Synchronize Slack and save before link the agents.")}</p>`;else{let t='<option value="-1"></option>';for(a=0;a<i.agents.length;a++)t+=`<option value="${i.agents[a].id}">${i.agents[a].name}</option>`;for(var a=0;a<i.slack_users.length;a++)s+=`<div data-id="${i.slack_users[a].id}"><label>${i.slack_users[a].name}</label><select>${t}</select></div>`}t(e).html(s),C.set("slack-agents",[i.saved,"double-select"])})}),t(g).on("click","#slack-archive-channels .sb-btn",function(e){t(this).sbLoading()||(t(this).sbLoading(!0),SBF.ajax({function:"archive-slack-channels"},e=>{!0===e&&a("Slack channels archived successfully!","info"),t(this).sbLoading(!1)})),e.preventDefault()}),"undefined"!=typeof SB_WP&&(t(g).on("click","#wp-synch .sb-btn",function(e){t(this).sbLoading()||(t(this).sbLoading(!0),SBF.ajax({function:"wp-synch"},e=>{!0===e?($.update(),a("WordPress users successfully imported.","info")):a("Error. Response: "+JSON.stringify(e),"info"),t(this).sbLoading(!1)})),e.preventDefault()}),t("body").on("click","#wp-admin-bar-logout",function(){SBF.logout()})),t(g).on("click","#tab-translations",function(){SBF.ajax({function:"get-translations"},e=>{let i,s="",a="";for(var r in e){let t=e[r].front,i=e[r].admin;s+=`<div data-code="${r}"><div data-area="front"><h2>${o("Front End")}<a class="sb-btn sb-icon sb-add-translation"><i class="sb-icon-plus"></i>${o("New translation")}</a></h2><div>`,a+=`<li data-code="${r}"><img src="${SB_URL}/media/flags/${r}.png" />${e[r].name}</li>`;for(var l in t)s+=`<div class="sb-input-setting sb-type-text"><label>${l}</label><div><input type="text" value="${t[l]}"></div></div>`;s+=`</div></div><div data-area="admin"><h2>${o("Admin")}</h2><div>`;for(var c in i)s+=`<div class="sb-input-setting sb-type-text"><label>${c}</label><div><input type="text" value="${i[c]}"></div></div>`;s+="</div></div></div>"}t(g).find(".sb-translations").html(`<ul class="sb-nav">${a}</ul><div class="sb-content">${s}</div>`),i=t(g).find(".sb-translations > div > div:first-child,.sb-translations > ul > li:first-child"),t(i).sbActivate(),C.translations_to_update.push(t(i).eq(0).data("code")),n(!1)}),n()}),t(g).on("click",".sb-add-translation",function(){t(this).parent().siblings().eq(0).prepend(`<div class="sb-input-setting sb-type-text sb-new-translation"><input type="text" placeholder="${o("Insert original text ...")}"><input type="text" placeholder="${o("Insert translation ...")}"></div></div>`)}),t(g).on("click",".sb-translations .sb-nav li",function(){let e=t(this).data("code");C.translations_to_update.includes(e)||C.translations_to_update.push(e)}),t(g).on("click","#tab-articles",function(){SBF.ajax({function:"get-articles",full:!0},e=>{if(!1!==e&&Array.isArray(e)){let s="",a=e.length;if(a){y=e;for(var i=0;i<a;i++)s+=`<li data-article-id="${y[i].id}">${y[i].title}<i class="sb-icon-delete"></i></li>`}else s=`<li class="sb-no-articles">${o("No articles found.")}</li>`;t(g).find(".sb-articles-area .sb-nav").html(s)}else SBF.error("Articles response not of type array or false","get-articles");n(!1)}),n()}),t(g).on("click",".sb-add-article",function(){let e=t(g).find(".sb-articles-area"),i=t(e).find(".sb-nav"),s=SBF.random();C.articles("save"),y.push({id:s,title:"",content:"",link:""}),t(i).find(".sb-active").sbActivate(!1),t(i).find(".sb-no-articles").remove(),t(i).append(`<li class="sb-active" data-article-id="${s}">${o("Article")} ${t(i).find("li").length+1}<i class="sb-icon-delete"></i></li>`),t(e).find("input, textarea").val(""),t(e).find(".sb-content").attr("data-article-id",s)}),t(g).on("click",".sb-articles-area .sb-nav i",function(){a("The article will be deleted.","alert",()=>{let e=t(this).closest(".sb-nav");y.splice(t(this).parent().index(),1),t(e).find("li").length>1?t(this).parent().remove():t(e).html(`<li class="sb-no-articles">${o("No articles found.")}</li>`)})}),t(g).on("click",".sb-articles-area .sb-nav li",function(){let e=t(g).find(".sb-articles-area"),i=t(this).attr("data-article-id"),s=[-1,"","",""];C.articles("save");for(var a=0;a<y.length;a++)if(y[a].id==i){s=[i,y[a].title,y[a].content,y[a].link],t(this).siblings().sbActivate(!1),t(this).sbActivate();break}t(e).find(".sb-content").attr("data-article-id",s[0]),t(e).find(".sb-article-title input").val(s[1]),t(e).find(".sb-article-content textarea").val(s[2]),t(e).find(".sb-article-link input").val(s[3])}),t(l).on("click",".sb-lightbox .sb-top-bar .sb-close",function(){t(l).sbHideLightbox()}),t(l).on("click",".sb-lightbox .sb-info",function(){t(this).sbActivate(!1)}),t(l).on("click",".sb-dialog-box a",function(){let e=t(this).closest(".sb-lightbox");t(this).hasClass("sb-confirm")&&_(),1==t(l).find(".sb-lightbox.sb-active").length&&t(l).find(".sb-lightbox-overlay").sbActivate(!1),t(e).sbActivate(!1)}),t(l).on("click",".sb-menu-wide li, .sb-nav li",function(){t(this).siblings().sbActivate(!1),t(this).sbActivate()}),t(l).on("click",".sb-nav li",function(){t(this).parent().parent().find(".sb-content > div").sbActivate(!1).eq(t(this).index()).sbActivate()}),t(l).find("[data-sb-tooltip]").each(function(){t(this).miniTip({content:t(this).attr("data-sb-tooltip"),anchor:"s",delay:500})}),t(l).on("click",'[data-button="toggle"]',function(){t(l).find("."+t(this).data("show")).addClass("sb-show-animation").show(),t(l).find("."+t(this).data("hide")).hide()}),t(l).on("click",".sb-info-card",function(){t(this).sbActivate(!1)}),t(l).find(".sb-upload-form-admin .sb-upload-files").change(function(e){t(this).sbUploadFiles(function(e){"success"==(e=JSON.parse(e))[0]?"upload-image"==t(v).data("type")&&t(v).find(".image").attr("data-url",e[1]).css("background-image",`url(${e[1]})`):console.log(e[1])})}));else{let e=t(l).find(".sb-intall");t(l).on("click",".sb-submit-installation",function(){if(!t(this).sbLoading()){let i=!1,s=t(e).find("#first-name").length;if(t(this).sbLoading(!0),SBForm.errors(e))i=s?"All fields are required. Minimum password length is 8 chars. Be sure you inserted a valid email.":"All fields are required.";else if(s&&t(e).find("#password input").val()!=t(e).find("#password-check input").val())i="The passwords does not match.";else{let s=window.location.href.replace("admin.php","").replace(/#$|\/$/,"").replace(/#$|\/$/,"");t.ajax({method:"POST",url:s+"/include/ajax.php",data:{function:"installation",details:t.extend(SBForm.getAll(e),{url:s})}}).done(s=>{if(!0!==(s=JSON.parse(s)[1])){switch(s){case"connection-error":i="Support Board can not connect to the database, please check the database information and try again.";break;case"missing-details":i="Missing database details, please check the database information and try again.";break;case"missing-url":i="Support Board can not get the plugin URL.";break;default:i=s}!1!==i&&(SBForm.showErrorMessage(e,i),t("html, body").animate({scrollTop:0},500)),t(this).sbLoading(!1)}else setTimeout(()=>{location.reload()},1e3)})}!1!==i&&(SBForm.showErrorMessage(e,i),t("html, body").animate({scrollTop:0},500),t(this).sbLoading(!1))}})}})}(jQuery),function(t,e){"object"==typeof exports?module.exports=e(t):"function"==typeof define&&define.amd?define("colors",[],function(){return e(t)}):t.Colors=e(t)}(this,function(t,e){function i(t,i,a,n,o){if("string"==typeof i){a=(i=m.txt2color(i)).type,f[a]=i[a],o=o!==e?o:i.alpha}else if(i)for(var c in i)t[a][c]=r(i[c]/l[a][c][1],0,1);return o!==e&&(t.alpha=r(+o,0,1)),s(a,n?t:e)}function s(t,e){var i,s,r,p=e||f,h=m,b=u.options,g=l,v=p.RND,_="",k="",x={hsl:"hsv",rgb:t},y=v.rgb;if("alpha"!==t){for(var S in g)if(!g[S][S]){t!==S&&(k=x[S]||"rgb",p[S]=h[k+"2"+S](p[k])),v[S]||(v[S]={}),i=p[S];for(_ in i)v[S][_]=d(i[_]*g[S][_][1])}y=v.rgb,p.HEX=h.RGB2HEX(y),p.equivalentGrey=b.grey.r*p.rgb.r+b.grey.g*p.rgb.g+b.grey.b*p.rgb.b,p.webSave=s=a(y,51),p.webSmart=r=a(y,17),p.saveColor=y.r===s.r&&y.g===s.g&&y.b===s.b?"web save":y.r===r.r&&y.g===r.g&&y.b===r.b?"web smart":"",p.hueRGB=m.hue2RGB(p.hsv.h),e&&(p.background=function(t,e,i){var s=u.options.grey,a={};return a.RGB={r:t.r,g:t.g,b:t.b},a.rgb={r:e.r,g:e.g,b:e.b},a.alpha=i,a.equivalentGrey=d(s.r*t.r+s.g*t.g+s.b*t.b),a.rgbaMixBlack=o(e,{r:0,g:0,b:0},i,1),a.rgbaMixWhite=o(e,{r:1,g:1,b:1},i,1),a.rgbaMixBlack.luminance=n(a.rgbaMixBlack,!0),a.rgbaMixWhite.luminance=n(a.rgbaMixWhite,!0),u.options.customBG&&(a.rgbaMixCustom=o(e,u.options.customBG,i,1),a.rgbaMixCustom.luminance=n(a.rgbaMixCustom,!0),u.options.customBG.luminance=n(u.options.customBG,!0)),a}(y,p.rgb,p.alpha))}var w,B,A,C=p.rgb,$=p.alpha,T="luminance",F=p.background;return w=o(C,{r:0,g:0,b:0},$,1),w[T]=n(w,!0),p.rgbaMixBlack=w,B=o(C,{r:1,g:1,b:1},$,1),B[T]=n(B,!0),p.rgbaMixWhite=B,b.customBG&&(A=o(C,F.rgbaMixCustom,$,1),A[T]=n(A,!0),A.WCAG2Ratio=function(t,e){var i=1;return i=t>=e?(t+.05)/(e+.05):(e+.05)/(t+.05),d(100*i)/100}(A[T],F.rgbaMixCustom[T]),p.rgbaMixBGMixCustom=A,A.luminanceDelta=c.abs(A[T]-F.rgbaMixCustom[T]),A.hueDelta=function(t,e,i){return(c.max(t.r-e.r,e.r-t.r)+c.max(t.g-e.g,e.g-t.g)+c.max(t.b-e.b,e.b-t.b))*(i?255:1)/765}(F.rgbaMixCustom,A,!0)),p.RGBLuminance=n(y),p.HUELuminance=n(p.hueRGB),b.convertCallback&&b.convertCallback(p,t),p}function a(t,e){var i={},s=0,a=e/2;for(var n in t)s=t[n]%e,i[n]=t[n]+(s>a?e-s:-s);return i}function n(t,e){for(var i=e?1:255,s=[t.r/i,t.g/i,t.b/i],a=u.options.luminance,n=s.length;n--;)s[n]=s[n]<=.03928?s[n]/12.92:c.pow((s[n]+.055)/1.055,2.4);return a.r*s[0]+a.g*s[1]+a.b*s[2]}function o(t,i,s,a){var n={},o=s!==e?s:1,r=a!==e?a:1,l=o+r*(1-o);for(var c in t)n[c]=(t[c]*o+i[c]*r*(1-o))/l;return n.a=l,n}function r(t,e,i){return t>i?i:e>t?e:t}var l={rgb:{r:[0,255],g:[0,255],b:[0,255]},hsv:{h:[0,360],s:[0,100],v:[0,100]},hsl:{h:[0,360],s:[0,100],l:[0,100]},alpha:{alpha:[0,1]},HEX:{HEX:[0,16777215]}},c=t.Math,d=c.round,u={},f={},p={r:.298954,g:.586434,b:.114612},h={r:.2126,g:.7152,b:.0722},b=function(t){this.colors={RND:{}},this.options={color:"rgba(0,0,0,0)",grey:p,luminance:h,valueRanges:l},g(this,t||{})},g=function(t,s){var a,n=t.options;v(t);for(var o in s)s[o]!==e&&(n[o]=s[o]);a=n.customBG,n.customBG="string"==typeof a?m.txt2color(a).rgb:a,f=i(t.colors,n.color,e,!0)},v=function(t){u!==t&&(u=t,f=t.colors)};b.prototype.setColor=function(t,a,n){return v(this),t?i(this.colors,t,a,e,n):(n!==e&&(this.colors.alpha=r(n,0,1)),s(a))},b.prototype.setCustomBackground=function(t){return v(this),this.options.customBG="string"==typeof t?m.txt2color(t).rgb:t,i(this.colors,e,"rgb")},b.prototype.saveAsBackground=function(){return v(this),i(this.colors,e,"rgb",!0)},b.prototype.toString=function(t,e){return m.color2text((t||"rgb").toLowerCase(),this.colors,e)};var m={txt2color:function(t){var e={},i=t.replace(/(?:#|\)|%)/g,"").split("("),s=(i[1]||"").split(/,\s*/),a=i[1]?i[0].substr(0,3):"rgb",n="";if(e.type=a,e[a]={},i[1])for(var o=3;o--;)n=a[o]||a.charAt(o),e[a][n]=+s[o]/l[a][n][1];else e.rgb=m.HEX2rgb(i[0]);return e.alpha=s[3]?+s[3]:1,e},color2text:function(t,e,i){var s=!1!==i&&d(100*e.alpha)/100,a="number"==typeof s&&!1!==i&&(i||1!==s),n=e.RND.rgb,o=e.RND.hsl,r="hex"===t&&a,l="hex"===t&&!r,c="rgb"===t||r?n.r+", "+n.g+", "+n.b:l?"#"+e.HEX:o.h+", "+o.s+"%, "+o.l+"%";return l?c:(r?"rgb":t)+(a?"a":"")+"("+c+(a?", "+s:"")+")"},RGB2HEX:function(t){return((t.r<16?"0":"")+t.r.toString(16)+(t.g<16?"0":"")+t.g.toString(16)+(t.b<16?"0":"")+t.b.toString(16)).toUpperCase()},HEX2rgb:function(t){return t=t.split(""),{r:+("0x"+t[0]+t[t[3]?1:0])/255,g:+("0x"+t[t[3]?2:1]+(t[3]||t[1]))/255,b:+("0x"+(t[4]||t[2])+(t[5]||t[2]))/255}},hue2RGB:function(t){var e=6*t,i=~~e%6,s=6===e?0:e-i;return{r:d(255*[1,1-s,0,0,s,1][i]),g:d(255*[s,1,1,1-s,0,0][i]),b:d(255*[0,0,s,1,1,1-s][i])}},rgb2hsv:function(t){var e,i,s,a=t.r,n=t.g,o=t.b,r=0;return o>n&&(n=o+(o=n,0),r=-1),i=o,n>a&&(a=n+(n=a,0),r=-2/6-r,i=c.min(n,o)),e=a-i,s=a?e/a:0,{h:1e-15>s?f&&f.hsl&&f.hsl.h||0:e?c.abs(r+(n-o)/(6*e)):0,s:a?e/a:f&&f.hsv&&f.hsv.s||0,v:a}},hsv2rgb:function(t){var e=6*t.h,i=t.s,s=t.v,a=~~e,n=e-a,o=s*(1-i),r=s*(1-n*i),l=s*(1-(1-n)*i),c=a%6;return{r:[s,r,o,o,l,s][c],g:[l,s,s,r,o,o][c],b:[o,o,l,s,s,r][c]}},hsv2hsl:function(t){var e=(2-t.s)*t.v,i=t.s*t.v;return i=t.s?1>e?e?i/e:0:i/(2-e):0,{h:t.h,s:t.v||i?i:f&&f.hsl&&f.hsl.s||0,l:e/2}},rgb2hsl:function(t,e){var i=m.rgb2hsv(t);return m.hsv2hsl(e?i:f.hsv=i)},hsl2rgb:function(t){var e=6*t.h,i=t.s,s=t.l,a=.5>s?s*(1+i):s+i-i*s,n=s+s-a,o=~~e,r=a*(a?(a-n)/a:0)*(e-o),l=n+r,c=a-r,d=o%6;return{r:[a,c,n,n,l,a][d],g:[l,a,a,c,n,n][d],b:[n,n,l,a,a,c][d]}}};return b}),function(t,e){"object"==typeof exports?module.exports=e(t,require("jquery"),require("colors")):"function"==typeof define&&define.amd?define(["jquery","colors"],function(i,s){return e(t,i,s)}):e(t,t.jQuery,t.Colors)}(this,function(t,e,i,s){function a(t){return t.value||t.getAttribute("value")||e(t).css("background-color")||"#FFF"}function n(t){return(t=t.originalEvent&&t.originalEvent.touches?t.originalEvent.touches[0]:t).originalEvent?t.originalEvent:t}function o(t){return e(t.find(h.doRender)[0]||t[0])}function r(i){var s=e(this),n=s.offset(),r=e(t),u=h.gap;i?(b=o(s),b._colorMode=b.data("colorMode"),f.$trigger=s,(g||l()).css(h.positionCallback.call(f,s)||{left:(g._left=n.left)-((g._left+=g._width-(r.scrollLeft()+r.width()))+u>0?g._left+u:0),top:(g._top=n.top+s.outerHeight())-((g._top+=g._height-(r.scrollTop()+r.height()))+u>0?g._top+u:0)}).show(h.animationSpeed,function(){!0!==i&&(x.toggle(!!h.opacity)._width=x.width(),m._width=m.width(),m._height=m.height(),v._height=v.height(),p.setColor(a(b[0])),d(!0))}).off(".tcp").on(A,".cp-xy-slider,.cp-z-slider,.cp-alpha",c)):f.$trigger&&e(g).hide(h.animationSpeed,function(){d(!1),f.$trigger=null}).off(".tcp")}function l(){return e("head")[h.cssPrepend?"prepend":"append"]('<style type="text/css" id="tinyColorPickerStyles">'+(h.css||R)+(h.cssAddon||"")+"</style>"),e(F).css({margin:h.margin}).appendTo("body").show(0,function(){f.$UI=g=e(this),$=h.GPU&&g.css("perspective")!==s,v=e(".cp-z-slider",this),m=e(".cp-xy-slider",this),_=e(".cp-xy-cursor",this),k=e(".cp-z-cursor",this),x=e(".cp-alpha",this),y=e(".cp-alpha-cursor",this),h.buildCallback.call(f,g),g.prepend("<div>").children().eq(0).css("width",g.children().eq(0).width()),g._width=this.offsetWidth,g._height=this.offsetHeight}).hide()}function c(t){var i=this.className.replace(/cp-(.*?)(?:\s*|$)/,"$1").replace("-","_");(t.button||t.which)>1||(t.preventDefault&&t.preventDefault(),t.returnValue=!1,b._offset=e(this).offset(),(i="xy_slider"===i?function(t){var e=n(t),i=e.pageX-b._offset.left,s=e.pageY-b._offset.top;p.setColor({s:i/m._width*100,v:100-s/m._height*100},"hsv")}:"z_slider"===i?function(t){var e=n(t).pageY-b._offset.top;p.setColor({h:360-e/v._height*360},"hsv")}:function(t){var e=(n(t).pageX-b._offset.left)/x._width;p.setColor({},"rgb",e)})(t),d(),S.on(C,function(){S.off(".tcp")}).on(B,function(t){i(t),d()}))}function d(t){var e=p.colors,i=e.hueRGB,a=(e.RND.rgb,e.RND.hsl,h.dark),n=h.light,o=p.toString(b._colorMode,h.forceAlpha),r=e.HUELuminance>.22?a:n,l=e.rgbaMixBlack.luminance>.22?a:n,c=(1-e.hsv.h)*v._height,d=e.hsv.s*m._width,f=(1-e.hsv.v)*m._height,g=e.alpha*x._width,S=$?"translate3d":"",w=b[0].value,B=b[0].hasAttribute("value")&&""===w&&t!==s;m._css={backgroundColor:"rgb("+i.r+","+i.g+","+i.b+")"},_._css={transform:S+"("+d+"px, "+f+"px, 0)",left:$?"":d,top:$?"":f,borderColor:e.RGBLuminance>.22?a:n},k._css={transform:S+"(0, "+c+"px, 0)",top:$?"":c,borderColor:"transparent "+r},x._css={backgroundColor:"#"+e.HEX},y._css={transform:S+"("+g+"px, 0, 0)",left:$?"":g,borderColor:l+" transparent"},b._css={backgroundColor:B?"":o,color:B?"":e.rgbaMixBGMixCustom.luminance>.22?a:n},b.text=B?"":w!==o?o:"",t!==s?u(t):T(u)}function u(t){m.css(m._css),_.css(_._css),k.css(k._css),x.css(x._css),y.css(y._css),h.doRender&&b.css(b._css),b.text&&b.val(b.text),h.renderCallback.call(f,b,"boolean"==typeof t?t:s)}var f,p,h,b,g,v,m,_,k,x,y,S=e(document),w=e(),B="touchmove.tcp mousemove.tcp pointermove.tcp",A="touchstart.tcp mousedown.tcp pointerdown.tcp",C="touchend.tcp mouseup.tcp pointerup.tcp",$=!1,T=t.requestAnimationFrame||t.webkitRequestAnimationFrame||function(t){t()},F='<div class="cp-color-picker"><div class="cp-z-slider"><div class="cp-z-cursor"></div></div><div class="cp-xy-slider"><div class="cp-white"></div><div class="cp-xy-cursor"></div></div><div class="cp-alpha"><div class="cp-alpha-cursor"></div></div></div>',R=".cp-color-picker{position:absolute;overflow:hidden;padding:6px 6px 0;background-color:#444;color:#bbb;font-family:Arial,Helvetica,sans-serif;font-size:12px;font-weight:400;cursor:default;border-radius:5px}.cp-color-picker>div{position:relative;overflow:hidden}.cp-xy-slider{float:left;height:128px;width:128px;margin-bottom:6px;background:linear-gradient(to right,#FFF,rgba(255,255,255,0))}.cp-white{height:100%;width:100%;background:linear-gradient(rgba(0,0,0,0),#000)}.cp-xy-cursor{position:absolute;top:0;width:10px;height:10px;margin:-5px;border:1px solid #fff;border-radius:100%;box-sizing:border-box}.cp-z-slider{float:right;margin-left:6px;height:128px;width:20px;background:linear-gradient(red 0,#f0f 17%,#00f 33%,#0ff 50%,#0f0 67%,#ff0 83%,red 100%)}.cp-z-cursor{position:absolute;margin-top:-4px;width:100%;border:4px solid #fff;border-color:transparent #fff;box-sizing:border-box}.cp-alpha{clear:both;width:100%;height:16px;margin:6px 0;background:linear-gradient(to right,#444,rgba(0,0,0,0))}.cp-alpha-cursor{position:absolute;margin-left:-4px;height:100%;border:4px solid #fff;border-color:#fff transparent;box-sizing:border-box}",E=function(t){p=this.color=new i(t),h=p.options,f=this};E.prototype={render:d,toggle:r},e.fn.colorPicker=function(i){var s=this,n=function(){};return i=e.extend({animationSpeed:150,GPU:!0,doRender:!0,customBG:"#FFF",opacity:!0,renderCallback:n,buildCallback:n,positionCallback:n,body:document.body,scrollResize:!0,gap:4,dark:"#222",light:"#DDD"},i),!f&&i.scrollResize&&e(t).on("resize.tcp scroll.tcp",function(){f.$trigger&&f.toggle.call(f.$trigger[0],!0)}),w=w.add(this),this.colorPicker=f||new E(i),this.options=i,e(i.body).off(".tcp").on(A,function(t){-1===w.add(g).add(e(g).find(t.target)).index(t.target)&&r()}),this.on("focusin.tcp click.tcp",function(t){f.color.options=e.extend(f.color.options,h=s.options),r.call(this,t)}).on("change.tcp",function(){p.setColor(this.value||"#FFF"),s.colorPicker.render(!0)}).each(function(){var t=a(this),s=t.split("("),n=o(e(this));n.data("colorMode",s[1]?s[0].substr(0,3):"HEX").attr("readonly",h.preventFocus),i.doRender&&n.css({"background-color":t,color:function(){return p.setColor(t).rgbaMixBGMixCustom.luminance>.22?i.dark:i.light}})})},e.fn.colorPicker.destroy=function(){e("*").off(".tcp"),f.toggle(!1),w=e()}});